%META:TOPICINFO{author="ProjectContributor" comment="" date="1485354263" format="1.1" reprev="1" version="1"}%
---+!! <nop>%TOPIC%
*Generates a static view of a web, as HTML files on disc, or as a =PDF=, or as a =zip= or =tgz= archive file, or by uploading directly to an FTP server.*

<!--

   PLEASE DO NOT EDIT THIS TOPIC

   It is automatically generated from the git repository, and any changes
   you make will simply be overwritten the next time a release is generated.

   Instead, you could check your fix in, raise a task in the Tasks web, or mail thge author.

   * Set SHORTDESCRIPTION = Generate static output (HTML, PDF) for a web and optionally upload (FTP) the output to a publishing site.
-->

_This is the most complete publishing solution for Foswiki._

<img src="%ATTACHURLPATH%/publish.gif" style="float:right" alt="" />
!PublishPlugin provides support for the generation of stand-alone HTML from a web. It will generate fully rendered versions of a set of Foswiki pages together with any attached files.

%TOC%

When you want to read a document stored in Foswiki, you have to have access to the web server that hosts that document. There are times when this may not be desirable, or even possible. For example:
   1 Foswiki is used to create documentation which has to be readable off-line
   1 Published versions of Foswiki pages must be read-only
   1 The Foswiki server is inaccessible to the audience (e.g. on the other side of a corporate firewall)
   1 You want to put product documentation on a CD

To address these requirements the PublishPlugin supports the generation of several different document formats from Foswiki pages, including HTML and PDF.

---++ Features
   * All standard Foswiki macros are interpreted, and plugins are called
   * Topic links internal to the wiki are translated to relative links
   * Powerful support for choosing what content gets published
   * Any links to the 'pub' areas of topics in the web are automatically resolved, and the referenced files copied
   * Any links to images outside the wiki are resolved, and the image is stored in the output (requires LWP)
   * Output in HTML or PDF
   * HTML can be compressed in different archive formats
   * Full support for hierarchical webs
   * Format-specific skins (such as viewpdf) can be specified
   * Able to publish HTML and referenced files directly to a remote server via ftp
   * Complete history of what was published, and when!
   * Fully compatible with [[Foswiki:Extensions.BookmakerPlugin][BookmakerPlugin]]

---++ Usage
The plugin can be used in a number of different ways:
   * Via the Publish Form on this page
   * Using a crafted =rest= call
   * From a re-usable configuration topic
   * From the command line
   * Using [[Foswiki:Extensions.BookmakerPlugin][BookmakerPlugin]] (if installed)
   
---+++ Publish Form
The quickest way to publish is by completing the following form.

The output is generated in a directory designated during installation. The progress messages printed during documentation generation tell you exactly where the output is. Admins can use the PublishPluginControlCentre to manage the published output.

Publishing is an access-controlled process; before you can publish, you have to have VIEW access to the topics you want to publish (and CHANGE access to the publishing history topic, if you have asked for one).

You can also create a [[#PublishTopic][permanent topic in a web]] to help with a repeated publishing process.

%H% Most publishing tasks will only require setting the immediately visible options.
Other more advanced options can be accessed by opening the collapsible sections.

%ADDTOHEAD{text="<style type=\"text/css\" media=\"all\">
.foswikiPageForm table th, .foswikiPageForm table td {
  vertical-align:top;
  border-bottom:1px solid #ddd;
  padding:.5em;
}
table.publishForm {
  width:100%;
}
table.publishForm th {
  background:#2989bb;
  color:#fff;
}
table.publishForm th, table.publishForm td {
  padding:0.4em 1em;
  text-align:left;
}
table.publishForm th {
  border-color:#2989bb;
}
table.publishForm td {
  border-color:#dfdfdf;
}
table.publishForm .nameCol {
  background:#f1f1f1;
}
table.publishForm .inputCol {
  background:#f7f9f0;
}
table.publishForm .infoCol {
  background:#f1f1f1;
}
table.publishForm .paramCol {
  background:#f7f9f0;
}
</style>"}%

<div class="foswikiPageForm">
<form method="post" name="publish" action="%SCRIPTURL{rest}%/PublishPlugin/publish">
<table class="foswikiTable publishForm">
  <tr>
    <th colspan="3">Choose what to publish</th>
    <th> Parameter Name </th>
  </tr>
  <tr>
    <td class="nameCol">
      Webs
    </td>
    <td class="inputCol">
      <select name="web" class="foswikiSelect">
        <option value=""></option>%WEBLIST{"<option $marker value='$name'>$name</option>" selection="%URLPARAM{"webs" default="%WEB%" encode="entity"}%"}%</select>
      <input type="checkbox" name="nosubwebs" class="foswikiCheckbox" title="Select to disable subweb expansion in the =webs= parameter"/> No subwebs
    </td>
    <td class="infoCol" rowspan="2">
The list of topics to publish is built using the =webs= and =topics=
parameters.

The =webs= parameter is used to give a list<sup>1</sup> of
web names, and the =topics= parameter to give a list<sup>1</sup> of topic names.

The final list of topics is built up from these parameters as follows:
   1 If =webs= is blank, make a list of _all_ webs (and subwebs<sup>2</sup>) in the wiki
      * If =webs= if _not_ blank, expand each web in the list to include all subwebs of those webs<sup>2</sup>
   1 If =topics= is blank, make a list of all topics in the webs found in step 1
      * If =topics= is _not_ blank, then for each entry in the list:
         1 If the entry _does not_ specify a web, look for it in all webs found in step 1, and add any matches to the topic list
            * If the topic does specify a web, add it to the list of topics
   1 If =inclusions= is not blank, filter the list of topics to include only
     those topics that match
   1 If =exclusions= is not blank, filter the list of topics to exclude
     those topics that match

<sup>1</sup> Lists are comma-separated. You can use Foswiki macros (such as %SEARCH) in both these parameters. However they do _not_ support wildcards.

<sup>2</sup> You can turn off subweb expansion using the =nosubwebs= parameter.
    </td>
    <td class="paramCol">
      =webs=

      =nosubwebs=
    </td>
  </tr>
  <tr>
    <td class="nameCol"> 
      Topics
    </td>
    <td class="inputCol"> 
      <input type="text" name="topics" class="foswikiInputField" value="%URLPARAM{"topics" default="" encode="entity"}%" size="30" title="Leave blank to publish all topics in the web"/>
     </td>
    <td class="paramCol">
      =topics=
    </td>
  </tr>
  <tr>
    <td colspan="4">
      %TWISTY{mode="div" showlink="Advanced topic selection..."}%
      <table class="foswikiTable publishForm">
      	<tr> 
      	  <td class="nameCol"> 
	    Topic Include Filter
	  </td>
	  <td class="inputCol"> 
	    <input type="text" name="inclusions" class="foswikiInputField" value="%URLPARAM{"inclusions" default="" encode="entity"}%" size="30" title="Use * to publish all topics in the topic list" />
	  </td>
	  <td class="infoCol">
	    Comma-separated list of [[#WildcardPattern][wildcard patterns]] that match the names of topics to include. This acts as a filter on the topic list.
	  </td>
	  <td class="paramCol"><code>inclusions</code></td>
        </tr>
	<tr>
	  <td class="nameCol"> 
	    Topic Exclude Filter
	  </td>
	  <td class="inputCol"> 
	    <input type="text" name="exclusions" class="foswikiInputField" value="%URLPARAM{"exclusions" default="" encode="entity"}%" size="30" title="Leave blank to include all topics in the topic list" />
	  </td>
	  <td class="infoCol">
	    Comma-separated list of [[#WildcardPattern][wildcard patterns]] that match the names of topics to exclude. This acts as a filter on the topic list.
	  </td>
	  <td class="paramCol">
	    =exclusions=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol"> 
	    Versions Topic
	  </td>
	  <td class="inputCol"> 
	    <input type="text" name="versions" class="foswikiInputField" value="%URLPARAM{"versions" default="" encode="entity"}%" size="30" title="Leave blank to publish the most recent version of each topic"/>
	  </td>
	  <td class="infoCol">
	    Name of a topic _in each published web_ that contains a table, each row of which maps topic names to the version of that topic to publish. <br />
	    The table can be generated by a =%<nop>SEARCH{}%= or other macro. For example: =|Web.<nop>TopicName|1.33|=.<br />
		If a topic does not appear in the table, the most recent version will be published.
	  </td>
	  <td class="paramCol">
	    =versions=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol"> 
	    Content Filter
	  </td>
	  <td class="inputCol"> 
	    <input type="text" name="rexclude" class="foswikiInputField" value="%URLPARAM{"filter" default="" encode="entity"}%" size="30" title="Leave blank to include all topics"/>
	  </td>
	  <td class="infoCol">
	    A regular expression that will cause a topic to be excluded if the expression matches the topic content. You can use a simple string here, which will be matched exactly, or you can read up on perl regular expressions on the web.
	  </td>
	  <td class="paramCol">
	    =rexclude=
	  </td>
	</tr>
      </table>
      %ENDTWISTY%
    </td>
  </tr>
  <!-- -->
  <tr>
    <th colspan="4">Processing options</th>
  </tr>
  <tr>
    <td colspan="4">
      Default processing of topics for publishing tries to render the topics as
      closely to the way they are viewed in the wiki as possible. These options
      provide a finer level of control.
    </td>
  </tr>
  <tr>
    <td colspan="4">
      %TWISTY{mode="div" showlink="Show processing options..."}%
      <table class="foswikiTable publishForm">
	<tr>
	  <td class="nameCol">Publish skin </td>
	  <td class="inputCol">
	    <input type="text" name="publishskin" class="foswikiInputField" size="20" value="basic_publish" title="Use basic_publish unless you have your own customised publishing skin"/>
	  </td>
	  <td class="infoCol">
            Setting of the =SKIN= preference to be used when topics are published. See [[%SYSTEMWEB%.Skins][Skins]] for more informations on skins. You are recommended to pick =basic_publish=, or =plain=, or a =print= skin.
	    Your installation may also offer a special =export= or =publish= skin.<br />%I% The =view= [[SkinTemplates][template]] is used to generate published pages, so =view.%URLPARAM{"skin" default="basic_publish"}%.tmpl= is the template that will be used to generate the output. You can preview any topic in this skin simply by appending =?skin=%URLPARAM{"skin" default="basic_publish"}%= to the end of the view URL. Note that the standard =VIEW_TEMPLATE= template override still works when publishing.
	  </td>
	  <td class="paramCol">
	    =publishskin=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">Extra Preferences </td>
	  <td class="inputCol">
	    <textarea name="preferences" class="foswikiInputField" rows="5" cols="80"></textarea>
	  </td>
	  <td class="infoCol">
	    Lets you define Foswiki [[PreferenceSettings][preferences]] that will be available for use in topics during this
	    publishing run. Define preferences one per line, using the syntax 
	    =PREFERENCE=VALUE= - for example, <verbatim>
TOOL_VERSION=3.14.15
ISBN=1-56592-149-6
</verbatim>
	    Preferences defined this way can be used in topics (including the history topic) like any other Foswiki preference.
	  </td>
	  <td class="paramCol">
	    =preferences=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol"> 
	    Enable/Disable Plugins 
	  </td>
	  <td class="inputCol">
            <!-- Keep this list in sync with Publisher.pm -->
	    <input type="text" name="enableplugins" class="foswikiInputField" value="%URLPARAM{"enableplugins" default="-CommentPlugin,-EditRowPlugin,-EditTablePlugin,-NatEditPlugin,-SubscribePlugin,-TinyMCEPlugin,-UpdatesPlugin" encode="entity"}%" size="30"title="Leave blank to enable all plugins"/><br />%TWISTY{showlink="View currently enabled plugins" hidelink="Hide currently enabled plugins"}% %ACTIVATEDPLUGINS% %ENDTWISTY%
	  </td>
	  <td class="infoCol">
	    Comma-separated list of plugins to enable during publishing.

            You can enable a normally-disabled plugin by giving the plugin name e.g. =MyPlugin=, or disable a normally-enabled plugin by prefixing it with a minus sign e.g. =-CommentPlugin=. You can disable _all_ plugins by starting the list with =-*= and then selectively enable plugins again later in the list e.g.
            =-*, !SmiliesPlugin, !AutoViewTemplatePlugin, !HomePagePlugin, !InterwikiPlugin=.

            You are recommended to disable any plugins that generate interactive buttons in the output. Only plugins present in =configure= can be enabled/disabled.
	  </td>
	  <td class="paramCol">
	    =enableplugins=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">Template </td>
	  <td class="inputCol">
	    <input type="text" name="template" class="foswikiInputField" size="20" value="view" title="Override default view template"/>
	  </td>
	  <td class="infoCol">
            By default the plugin uses the default =view= template when it
            renders topics for publishing. You can override this here. Note
            that this is a very specialised feature; you will normally
            only need to override the skin when publishing.
          </td>
	  <td class="paramCol">
	    =template=
	  </td>
	</tr>
        <tr>
          <td class="nameCol">Copy External Resources </td>
          <td class="inputCol">
            <input type="checkbox" name="copyexternal" checked="checked" class="foswikiCheckbox" />
          </td>
          <td class="infoCol">
            Copy externally referenced resources (e.g. images on other servers).
            This option enables the copying of resources hosted on external
	    servers into the published content. If it is disabled, the plugin
	    will maintain an internet link to the external content. Enable this
            option if you want the pubished content to be totally self-contained
            (for example, for offline reading) or disable it for faster
            publishing process and smaller output.
          </td>
          <td class="paramCol">
            =copyexternal=
          </td>
 	</tr>
        <tr>
          <td class="nameCol">Publish All Attachments </td>
          <td class="inputCol">
            <input type="checkbox" name="allattachments" class="foswikiCheckbox" />
          </td>
          <td class="infoCol">
            Normally only attachments that are explicitly referenced in the
            text are published. Enable this option to publish attachments
            on topics that are not referenced in the text as well.
          </td>
          <td class="paramCol">
            =allattachments=
          </td>
 	</tr>
        <tr>
          <td class="nameCol">Publishing history topic</td>
          <td class="inputCol">
            <input type="text" name="history" class="foswikiInputField" size="30" value="" />
          </td>
          <td class="infoCol">
            This is where the history of your publishing is stored. Specify a full web.topic name (you must have write access). Each time you publish, this topic is re-written with the log of the publishing process. You need CHANGE access to this topic. You can leave this blank if you don't need a history.
          </td>
          <td class="paramCol">
            =history=
          </td>
        </tr>
      </table>
      %ENDTWISTY%
    </td>
  </tr>
  <!-- -->
  <tr>
    <th colspan="4">Output options</th>
  </tr>
  <tr>
    <td class="nameCol">Output format</td>
    <td class="inputCol">
      <select name="format" id="selectedFormat" class="foswikiSelect">
        %PUBLISHING_GENERATORS{format="<option>$name</option>" separator=""}%
      </select>
    </td>
    <td class="infoCol">
      The available formats are:
      <dl>
        %PUBLISHING_GENERATORS{format="<dt> =$name= </dt><dd>$help</dd>" separator=""}%
      </dl>
    </td>
    <td class="paramCol">
      =format=
    </td>
  </tr>
  <!-- FILE OUTPUT OPTIONS -->
  <tr>
    <th colspan="4">File output options</th>
  </tr>
  <tr class="publishOptionsSet fileOptions ftpOptions">
    <td colspan="4">
      File output options are relevant when output is being written to local files
      on disc.
    </td>
  </tr>
  <tr>
    <td colspan="4">
      %TWISTY{mode="div" showlink="Show file output options..."}%
      <table>
	<tr>
	  <td class="nameCol">Output file </td>
	  <td class="inputCol">
	    <input type="text" size="30" name="outfile" value="" class="foswikiInputField" title="Defaults to the name of the generator" />
	  </td>
	  <td class="infoCol">
	    Specify the root of the target output file name. This will have an appropriate extension added, if you don't give one (e.g. =.pdf=)
	  </td>
	  <td class="paramCol">
	    =outfile=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">Google file (not =pdf=)</td>
	  <td class="inputCol">
	    <input type="text" size="30" name="googlefile" value="" class="foswikiInputField" title="Leave blank if you don't need one" />
	  </td>
	  <td class="infoCol">
	    Generates the "HTML verification file" needed to verify your site claim.
	    See <a href="http://www.google.com/webmasters/sitemaps/">Google webmaster tools</a>.
	  </td>
	  <td class="paramCol">
	    =googlefile=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">
            Default page (not =pdf=)</td>
	  <td class="inputCol">
	    <input type="text" size="30" name="defaultpage" value="WebHome" class="foswikiInputField" />
	  </td>
	  <td class="infoCol">
	    Name of topic to used to generate default.htm, index.html
	  </td>
	  <td class="paramCol">
	    =defaultpage=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">
	    Extended directory path (not =pdf=)
	  </td>
	  <td class="inputCol">
	    <input type="text" size="30" name="relativedir" value="" class="foswikiInputField" title="Leave blank to publish directly in {Plugins}{PublishPlugin}{Dir}" />
	  </td>
	  <td class="infoCol">
	    Path of a directory relative to ={Plugins}{PublishPlugin}{Dir}= where you want the output generated. Blank means generate the output directly in
	    ={Plugins}{PublishPlugin}{Dir}=. This allows you to keep different publishings of the same content separated.
	  </td>
	  <td class="paramCol">
	    =relativedir=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">
	    Resource Directory (not =pdf=)
	  </td>
	  <td class="inputCol">
	    <input type="text" size="30" name="rsrcdir" value="rsrc" class="foswikiInputField" title="Directory relative to the root of your site" />
	  </td>
	  <td class="infoCol">
	    When publishing to HTML, attachments, icons, etc, are output to this directory. The directory name is relative to the root of your published site.
	  </td>
	  <td class="paramCol">
	    =rsrcdir=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">
	    Relative URL (=file= and =flatfile= only)
	  </td>
	  <td class="inputCol">
	    <input type="text" size="30" name="relativeurl" value="/" class="foswikiInputField" title="Use / if you will publish to the root of your site" />
	  </td>
	  <td class="infoCol">
	    The base URL that your published Foswiki topics will reside at, for instance to create different publishing instances like =dev=, =test= and =public=. Use =/= if you will publish to the root of your site. See also <a href="http://www.google.com/webmasters/sitemaps/">Google webmaster tools</a>.
	  </td>
	  <td class="paramCol">
	    =relativeurl=
	  </td>
	</tr>
      </table>
      %ENDTWISTY%
    </td>
  </tr>
  <!-- FTP OPTIONS -->
  <tr>
    <th colspan="4">FTP output options</th>
  </tr>
  <tr>
    <td colspan="4">
      FTP output options are only relevant if the output format is =ftp=.
    </td>
  </tr>
  <tr>
    <td colspan="4">
      %TWISTY{mode="div" showlink="Show FTP options..."}%
      <table class="foswikiTable publishForm">
	<tr>
	  <td class="nameCol">
	    Server address
	  </td>
	  <td class="inputCol">
	    <input type="text" size="30" name="destinationftpserver" value="" class="foswikiInputField" />
	  </td>
	  <td class="infoCol">
	    Set to blank to proof the output prior to uploading to your site.
	  </td>
	  <td class="paramCol">
	    =destinationftpserver=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">Server path</td>
	  <td class="inputCol">
	    <input type="text" size="30" name="destinationftppath" value="" class="foswikiInputField" />
	  </td>
	  <td class="infoCol">
	    Path to upload to on the FTP server.
	  </td>
	  <td class="paramCol">
	    =destinationftppath=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">Username</td>
	  <td class="inputCol">
	    <input type="text" size="30" name="destinationftpusername" value="" class="foswikiInputField" />
	  </td>
	  <td class="infoCol">
	    FTP server user name.
	  </td>
	  <td class="paramCol">
	    =destinationftpusername=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">
	    Password
	  </td>
	  <td class="inputCol">
	    <input type="password" size="30" name="destinationftppassword" value="" class="foswikiInputField" />
	  </td>
	  <td class="infoCol">
	    FTP server password.
	  </td>
	  <td class="paramCol">
	    =destinationftppassword=
	  </td>
	</tr>
	<tr>
	  <td class="nameCol">
	    Fast publish
	  </td>
	  <td class="inputCol">
	    <input type="checkbox" name="fastupload" checked="checked" class="foswikiCheckbox" />
	  </td>
	  <td class="infoCol">
	    Speed up the ftp publishing by only uploading modified files. This will store a (tiny) checksum (.md5) file on the server alongside each uploaded file which will be used to optimise future uploads. Recommended.
	  </td>
	  <td class="paramCol">
	    =fastupload=
	  </td>
	</tr>
      </table>
      %ENDTWISTY%
    </td>
  </tr>
  <!-- OTHER OUTPUT OPTIONS -->
  <tr>
    <th colspan="4">
      Other output generator options
    </th>
  </tr>
  <tr>
    <td colspan="4">
      Some output generators (e.g. pdf) support extra options.
    </td>
  </tr>
  <tr>
    <td colspan="4">
      %TWISTY{mode="div" showlink="Show extra options..."}%
      <table class="foswikiTable publishForm">
	<tr>
	  <td class="nameCol">
	    Extras
	  </td>
	  <td class="inputCol">
	    <textarea name="extras" rows="7" cols="30" class="foswikiInputField">%URLPARAM{"extras" default="" encode="entity"}%</textarea>
	  </td>
	  <td class="infoCol">
	    Some output generators support extra options (e.g. for =pdf=, you can add =htmldoc= command-line parameters here, such as =--linkstyle underline=). These options are passed directly to the output generator.
	  </td>
	  <td class="paramCol">
	    =extras=
	  </td>
	</tr>
      </table>
      %ENDTWISTY%
    </td>
  </tr>
  <!-- SUBMIT -->
  <tr>
    <td colspan="4" class="inputCol">
      <input type="submit" class="foswikiSubmit" value="Publish" />
    </td>
  </tr>
</table>
</form>
</div>

---+++ Using a =rest= call

Create a link that invokes the =rest= script and pass the current topic in param =inclusions=:
<verbatim>
<a class='foswikiPopUp'
href='%SCRIPTURLPATH{"rest"}%/PublishPlugin/publish?%REVARG%;
web=%BASEWEB%;
inclusions=%BASETOPIC%;
format=file;
skin=myskin;
defaultpage=WebHome'
rel='nofollow'>
Publish this page
</a>
</verbatim>
(added newlines for readability).

Now you can use this link in a skin adaption to put the link (or button) on all pages. Example of a template:

<verbatim>
%TMPL:INCLUDE{view}%

%TMPL:DEF{"printable"}%<span><a class='foswikiPopUp'
href='%SCRIPTURLPATH{"rest"}%/PublishPlugin/publish?%REVARG%;
web=%BASEWEB%;
inclusions=%BASETOPIC%;
format=file;
skin=myskin;
defaultpage=WebHome'
rel='nofollow'>Publish this page</a></span>%TMPL:END%
</verbatim>

#BookMaker
---+++ Using Bookmaker
The Bookmaker allows you to select a number of topics by visiting them in turn and adding them to the book. Once your book is complete, you can return to this page to publish it.

To start the bookmaker, %IF{"context 'BookmakerPluginEnabled'"
 then="$percntBUTTON{\"click here\" class=\"bookmaker_button\" href=\"%SCRIPTURL{view}%/%SYSTEMWEB%/BookmakerPlugin?open_bookmaker=Sandbox.WebOrder\"}$percnt"
 else="enable the !BookmakerPlugin, and revisit this page to enable the interface"}%. Once the bookmaker is running, visit the pages you want to add to the book and add them to the book. Once you are finished, use the bookmaker interface to return to this page to publish the results. To publish a book generated by Bookmaker, use the =%<nop>BOOKLIST{"Bookweb.BookName"}%= macro in the =topics= parameter.

#PublishTopic
---+++ Using a Publish Topic (configtopic)
You can create a publish topic that contains all the details needed to publish. This is just a topic with a series of standard preference settings (which correspond to the parameters described here) in it.

You can use the PublishWeb topic in this web as a template for your own topics.

To use a publish topic, you must pass the =configtopic= parameter to the =publish= script set to the name of the topic to use to control publishing. This should be a full web.topic specification (if you only give a topic name it will pick the topic up from the %USERSWEB%).

---+++ Publishing from the command line
Just =cd= to the =bin= directory, and
=perl rest /PublishPlugin/publish=. Parameters are passed as name=value pairs, for example:
<verbatim>
perl rest /PublishPlugin/publish webs=Book exclusions='Web*' format=file
perl rest /PublishPlugin/publish webs=Book inclusions=WebBook format=pdf extras='--book --duplex --toclevels=5'
</verbatim>
The available parameter names are shown in the publish form above, in the last column. Where parameters take multiple values (e.g. =preferences=) then you can separate the values using semicolons.

---++ How-tos
---+++ Controlling which parts of a topic get published
You can control what gets published from a topic using =%<nop>STARTPUBLISH%= and =%<nop>STOPPUBLISH%= control tags:
   * If =%<nop>STARTPUBLISH%= is the first control tag seen in the file, everything before it will be ignored.
   * Everything between =%<nop>STOPPUBLISH%= and the next =%<nop>STARTPUBLISH%= (or the end of the topic) will be ignored.
   * =%<nop>STARTPUBLISH%= and =%<nop>STOPPUBLISH%= will be visible in the viewed topic, so you can easily see what will be published from the topic.
Note: the old &lt;nopublish> tag is deprecated and should be replaced in topics

Another good trick is to set up a special "publishing" web. Create topics in the web that %INCLUDE the topics from *other* webs that you want to publish. You can use [[%SYSTEMWEB%.VarSTARTSECTION][STARTSECTION]] and [[%SYSTEMWEB%.VarENDSECTION][ENDSECTION]] to highlight what you want published. This way the "publishing" web gives you a view of exactly what will be in the published output, without the need for special publishing tags.

#WildcardPattern
---+++ Using Wildcard Patterns
A wildcard is a special string that you can put into a filename so that it matches a whole range of files:
| *String* | *What  it does* | *Example* | *What the example matches* |
| * | Matches any string, including an empty string. | =*Cheese*= | Every topic with "Cheese" somewhere in the name (but _not_ "cheese") |
| ? | Matches any single character. | Example1? | Example10 and Example 1X but _not_ example1 |
| [...] | Matches any one of the enclosed characters.  A pair of characters separated by a hyphen denotes a range  expression; any  character that sorts between those two characters, inclusive, using the current locale's collating sequence and character set, is matched.  If the first character following the [ is a ^ then any character not enclosed is matched. A - may be matched by including it as the first or  last  character  in  the set.  A ] may be matched by including it as the first character in the set.<br /> Within  [  and ], character classes can be specified using the syntax [:class:], where class is one of the following classes defined in the POSIX.2 standard: =alnum=, =alpha=, =ascii=, =blank=, =cntrl=, =digit=, =graph=, =lower=, =print=, =punct=, =space=, =upper=, =word=, =xdigit=. A character class matches any character belonging to that class.  The =word= character class matches letters, digits, and the character _. | B[aeiou]g | Bag, Bog, Big, Beg, Bug |

#WhereToFindTheOutput
---+++ Where to find the output
The !PublishPlugin uses an "acrhive" abstration to generate output
in differen formats. All archives are interfaced to assuming that a
directory structure
is being created for the published content. This directory structure
reflects the hierarchical web structure of the wiki. Topics are stored
by writing HTML files to paths relative to the root of this
structure. Thus, the topic =System.Web<nop>Home= will be stored to
=/System/WebHome.html=.  Attachments to topics are stored in a special
'.attachments' subdirectory next to the =.html= file, so attachment
'System.Web<nop>Home:example.gif' will be stored to
=/System/WebHome.attachments/example.gif=.

The special top-level directory '/_external' is reserved for storing
external resources (those referenced from topics and downloaded)

As far as possible, all internal links within the published HTML will
be generated as *relative* links. So for example, if
=Myweb.My<nop>Topic= links to =Yourweb.Your<nop>Topic= the link will
look like this: =../Yourweb/Your<nop>Topic.html=

Broken links may be generated if the target topic is not included in
the list of topics to publish.

Irrespective of the archive being used, output is always generated in
the directory specified by the ={Plugins}{PublishPlugin}{Dir}= [[%SCRIPTURL{configure}%#PublishPlugin$Extensions][configuration setting]]. Administrators can
manage the contents of this directory from the browser using the
=%<nop>PUBLISHERS_CONTROL_CENTRE%= macro (see PublishPluginControlCentre).

If _relativedir_ is set, then it will be added to ={Plugins}{PublishPlugin}{Dir}=.

If _outfile_ is not set in the parameters it defaults to the name of the format being published.

Most formats generate a single file with a unique extension that identifies the format e.g. =.pdf=. When publishing a format that generates multiple files (e.g. =file=) then _oufile_ will be a directory.

%X% The rendered data can get pretty big, and the publishing process itself puts a heavy load on the server, especially when using compression on large webs.

---++ Publishing History
Every time a web is published, then the results of that publishing step are stored in a topic in the web. By default this topic is called =PublishPluginHistory=, but you can choose another name (see the form, above). In order to publish a web, you have to be able to write to this topic. 

If the selected publishing skin defines a [[SkinTemplates][skin template]] called =publish_history=, then that template will be used as the basis of the history topic. This (for example) allows you to use a template with a skin to define access controls for the history topic. The template can refer to a Foswiki macro =%<nop>PUBLISHING_HISTORY%= to get the expanded history. The =basic_publish= skin provides =templates/publish_history.basic_publish.tmpl= for this purpose.

The history topic contains a list of all the parameters used, and the versions of the topics that were published, so it is very useful for tracking exactly what you publish. It is written every time you run =publish=.

---++ Installation Instructions

%$INSTALL_INSTRUCTIONS%

*IMPORTANT* Run =configure= and complete the installation in the *PublishPlugin* section.

If you want to generate PDF files, you will need to install a PDF generator, for example =htmldoc= or =prince=. Find them using google.

Note that =htmldoc= can also be used to generate !PostScript by using the =-t= option in the =Other output generator options= above. See the =htmldoc= man pages for details.

If you want =.zip= output you will have to install =Archive::Zip= and everything it depends on.

If you want =.tgz= (tar) output, install Archive::Tar and everything it depends on.
Install Archive::Zip and everything it depends on

*WARNING!* Anything published is no longer under the
control of Foswiki access controls, and if you make the publish output
directory visible on the web then you may need to
take precautions to prevent accidental leakage of confidential information
by restricting web access to this directory, for example in the Apache
configuration.

One way to do this is to use the =viewfile= access rights management to control
access to the published content:
   * Create a hidden web named e.g. Publish
   * Make this web public readable (via Publish.WebPreferences; ALLOW/DENYTOPICVIEW)
   * Create a topic Publish.PublishedContent
   * Change !PublishPlugin Settings in =configure= to publish to =pub/Publish/PublishedContent=
Access controles on =Publish= web and =!Publish.PublishedContent= will then
apply.

---++ Dependencies

%$DEPENDENCIES%

---++ Change History

%TABLE{columnwidths="10em" tablewidth="100%"}%
|  3.0 (19 Apr 2017) | Extensively rewritten to separate concerns and get rid of some of the poor code that had crept in over the years. Removed ability to publish several templates in one go, due to performance and complexity concerns. Removed flatpdf format, as it's pretty useless with modern htmldoc. Renamed =topiclist= to =topics=, =topicsearch= to =rexclude= and =skin= to =publishskin=. WARNING: untested on Foswiki <2 |
|  2.5 (25 Jan 2017) | Update to work with Foswiki 2.x.  Foswikitask:Item14198 Foswikitask:Item11808 Foswikitask:Item8898  |
|  2.4 (30 Jul 2012) | Foswikitask:Item12016 Add capability to construct flat HTML and PDF files. Bugfixes: Foswikitask:Item11988 Foswikitask:Item11339 Foswikitask:Item11345 Foswikitask:Item8260 Foswikitask:Item10597 Foswikitask:Item11346 |
|  2.3.2 (10 Aug 2011) | Foswikitask:Item10944: Fix publishing of attachments |
|  2.3.1 (14 Jun 2011) | Foswikitask:Item10870: support skinning of the history topic. Foswikitask:Item10870: support definition of session preferences from the publish form. Foswikitask:Item10843: bugfix to publishers control centre |
|  2.2.1 (25 May 2011) | Foswikitask:Item10578: allow list of publishskins; Foswikitask:Item10580: allow empty outfile param; Foswikitask:Item10585: support all valid topic names in topiclist; Foswikitask:Item10578: made template purging configurable Foswikitask:Item10594: merged patch; Foswikitask:Item10581: correct paths to resources in HTML output. (Diab Jerius and Crawford Currie) |
|  2.2.0 (28 Mar 2011) | Foswikitask:Item8225: fix handling of plugin contexts Foswikitask:Item2635: make sure index.html is generated Foswikitask:Item10529: test integration with BookmakerPlugin via new topiclist parameter |
|  2.1.7 (01 Nov 2010) | Foswikitask:Item8658: fix rest output when publishing to file, pdf and ftp |
|  2.1.6 (29 Oct 2010) | Foswikitask:Item8522: support for Foswiki 1.1.x and also 1.0.x+ZonePlugin Foswikitask:Item1638: fixed finding resources with parameters (e.g. =?t=2365421=) |
|  2.1.5 (05 Feb 2010) | Documentation update. |
|  2.1.4 (12 Jan 2010) | Foswikitask:Item2557: fixed publish head elements added by ADDTOHEAD |
|  2.1.3 (11 Jan 2010) | Foswikitask:Item2615: fixed finding resources not inside quotes |
|  2.1.2 (30 May 2009) | Foswikitask:Item8168: fixed genopt (extras) |
|  2.1.1 (22 May 2009) | Foswikitask:Item8165: fixed missing BASEWEB and other internal preferences. This was resulting in the wrong web being used for some operations |
|  2.1.0 (16 May 2009) | Foswikitask:Item1626: fixed META{"formfield" Foswikitask:Item8150: (Marc Schaefer) fix for -skin parameter Foswikitask:Item1557: doc fix Foswikitask:Item1585: allow history topic in different web Foswikitask:Item871: add missing newline at start of topic text. Foswikitask:Item1449: topic publisher was not popping the context correctly Foswikitask:Item1632: improve backporting support |
|  2.0.2 (18 Mar 2009) | Foswikitask:Item804: automatically create publish dir Foswikitask:Item8078: support publishing to a subdir of the publish dir, under url param control |
|  2.0.1 (14 Feb 2009) | Foswikitask:Item1033: fixed button in PublishWeb |
|  2.0.0 (27 Nov 2008) | Foswikitask:Item8019: refactored as a plugin and tested in Foswiki |
|  1.6.5 (27 Oct 2008) | Foswikitask:Item5385: Fixed doc for configtopic Foswikitask:Item5388: $WEB and $TOPIC were not correct in %IF statements Foswikitask:Item5390: remove comments from .css before processing for included resoures Foswikitask:Item5706: Improved FTP upload process for incrementally maintained webs Foswikitask:Item6029: expand config topic on load to support use of searches Foswikitask:Item6030: respect VIEW_TEMPLATE in published topics Foswikitask:Item6092: expand common tags in configtopic Foswikitask:Item6094: move sitemap options into base file generator Foswikitask:Item6110: rename settings in config topic to avoid clashes with other plugins |
|  1.6.4 (11 Dec 2007) | Foswikitask:Item5099 fixed |
|  1.6.3 (10 Nov 2007) | Tested on 4.2.0. Foswikitask:Item4624:, Foswikitask:Item4625: Foswikitask:Item4830: fixed. Foswikitask:Item4825: added a basic skin to avoid the confusion caused by =text= skin. Foswikitask:Item4951: added interface to allow management of output files |
|  1.6.2 | fixed ftp publish, added doco, and added enabled plugin selection funcitonality |
|  1.6.1 | Foswikitask:Item3722 worked around core attaching URL params to internal URLs |
|  1.6.0 | Foswikitask:Item3671 cannot publish without write access to history topic, so \
security now checked early. Foswikitask:Item3619 Cleaned up error handling from \
writers. Foswikitask:Item3675 added history topic to record changeset. Plus major \
refactoring of main class to get rid of some of the cruft that had built \
up from many authors. Foswikitask:Item2726: uses getExternalResource now, so should \
obey proxy settings (untested) |
|  1.5.5 | Added support for new internal api - no user changes |
|  1.5.4 | Added UI for FTP. Added .spec file. Fixed Foswikitask:Item3515 and Foswikitask:Item2725 |
|  1.5.3 | Michael Daum - create a new wiki object for every topic, don't reuse the current one (Foswikitask:Item3139) |
|  1.5.2 | Correction to the correction for anchors. |
|  1.5.1 | Correction to support anchors in URLs properly |
|  1.5.0 | Martin Cleaver - changes to allow generation of viewprint and viewxxx when specified by TEMPLATE; multiple INSTANCE (dev/test/prod); (Foswikitask:Item2269) |
|  1.4.3 | Bugfix Foswikitask:Item2216 |
|  1.4.2 | Crawford Currie - fixed problem where it was failing to remove <base> tags completely (Foswikitask:Item2200) |
|  1.4.1 | Crawford Currie - added doc on usage from command line, corrected sense of topicsearch filter (Foswikitask:Item2120, Foswikitask:Item2121), renamed parameters (old ones are still valid), corrected handling of empty web refs (Foswikitask:Item2128), deprecated nopublish html-style tag in favour of !PublishWebPlugin-compatible style (though with richer semantics) (Foswikitask:Item2196) |
|  1.4.0 | Crawford Currie - added support for hierarchical webs, and inclusion of external images. |
|  1.3.9 | Crawford Currie - added tgz and pdf support |
|  1.3.8 | Michael Daum - fixed rewriting urls; \
fixed nested resources issue; \
creating a new prefs object for each topic |
|  1.3.7 | Corrected form action so it uses up the right web preferences |
|  1.3.6 | Michael Daum - recursively archive resources imported by css files;\
fixed several html errors in the !PublishPlugin and !PublishWeb topics;\
removed hardcoded reference to print.pattern |
|  1.3.5 | TWiki-4 version. Also supports publishing to a file area, making TWiki easier to use as a CMS (see also Foswiki:Extensions/PublishWebPlugin, which does almost the same thing :-( ) |
|  1.3.4 | Foswikitask:Item196 - bugfix for HTTP_HOST, as described in the Dev topic for the contrib |
|  1.3.3 | Changed interface to support wildcards, and lightened the plugin by replacing a lot of files with simpler ways of doing things. |
|  1.3.2 | Added Compress::Zlib dependency, as requested by Brad Taylor |
|  1.3.1 (27 Apr 2005) | Crawford Currie - fixed minor issues highlighted by Bruce Dillahunty and Scott Claridge |
|  1.3.0 (11 Apr 2005) | Crawford Currie - reworked the interface and code to work better |
|  1.2.0 (13 October 2004) | Crawford Currie - Cairo compatible |
|  1.1.0 (7 Jan 2003) | Initial version |

---++ Info & Copyright

This add-on started life as the !GenHTMLAddon, written by Foswiki:Main/CrawfordCurrie at Motorola. It was then extended by Eric Scouten, and then further fixed and enhanced by Foswiki:Main/CrawfordCurrie (http://c-dot.co.uk). It has also been extended by Foswiki:Main/SvenDowideit and Foswiki:Main/MartinCleaver, and most recently refactored for Foswiki by Foswiki:Main/CrawfordCurrie. Other significant contributors are Foswiki:Main.ArthurClemens and Foswiki:Main.MichaelDaum.

This code is a development of the Architectures and System Platforms group of Motorola Inc. and is protected by the following copyrights:
   * Copyright &copy;  2001 Motorola. All Rights Reserved.
   * Copyright &copy;  2002-2003, Eric Scouten.
   * Copyright &copy;  2004-2006 Crawford Currie http://c-dot.co.uk
   * Copyright &copy;  2006 Martin Cleaver http://www.cleaver.org
   * Copyright &copy;  2006-2017, Foswiki Contributors

The 2005 functionality improvements were sponsored by [[http://www.windriver.com][Wind River Systems]]

The =pdf= and =tgz= output formats were made possible by [[http://www.sabiolabs.com][ =Sabio Labs= ]]

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details, published at
http://www.gnu.org/copyleft/gpl.html

%META:FORM{name="PackageForm"}%
%META:FIELD{name="Author" title="Author" value=""}%
%META:FIELD{name="Version" title="Version" value="%25$VERSION%25"}%
%META:FIELD{name="Release" title="Release" value="%25$RELEASE%25"}%
%META:FIELD{name="Description" title="Description" value="%25$SHORTDESCRIPTION%25"}%
%META:FIELD{name="Repository" title="Repository" value="https://github.com/foswiki/%25TOPIC%25"}%
%META:FIELD{name="Copyright" title="Copyright" value="&copy; 2006-2017, Foswiki Contributors, &copy; 2004-2006 Crawford Currie http://c-dot.co.uk, &copy; 2002-2003, Eric Scouten., &copy;  2006 Martin Cleaver http://www.cleaver.org, &copy; 2001 Motorola. All Rights Reserved. "}%
%META:FIELD{name="License" title="License" value="GPL ([[http://www.gnu.org/copyleft/gpl.html][GNU General Public License]])"}%
%META:FIELD{name="Home" title="Home" value="Foswiki:Extensions/%25TOPIC%25"}%
%META:FIELD{name="Support" title="Support" value="Foswiki:Support/%25TOPIC%25"}%
%META:FILEATTACHMENT{name="publish.gif" attr="h" comment="Logo"}%
%META:FILEATTACHMENT{name="wikiringlogo20x20.png" attr="h" comment="" version="1"}%
